{"version":3,"sources":["bfs.ts"],"names":["BuildFeed","ajax","timeout","MobileMenuToggle","ev","preventDefault","list","this","nextElementSibling","classList","toggle","DropdownClick","linkParent","parentElement","alreadyOpen","contains","CloseDropdowns","menuClickCapture","document","getElementById","add","ddParents","getElementsByClassName","i","length","remove","SwitchTheme","cookie","dataset","location","reload","SwitchLanguage","OpenSearch","modal","CloseSearch","StopClick","stopPropagation","InitiateSearch","resultPane","innerHTML","clearTimeout","readyState","XMLHttpRequest","DONE","abort","setInterval","SendSearch","modalInput","onreadystatechange","CompleteSearch","open","value","setRequestHeader","send","status","templateContent","content","jsrender","templates","render","JSON","parse","responseText","resultLinks","getElementsByTagName","addEventListener","mev","ga","assign","currentTarget","href","BuildFeedSetup","j","childNodes","el","nodeName","menuTheme","ddThemes","menuLang","ddLangs","btnNav","btnSearch","modalOverlay","modalDialog","window"],"mappings":"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","file":"bfs.js","sourcesContent":["/// <reference path=\"../../node_modules/@types/google.analytics/index.d.ts\" />\r\n/// <reference path=\"../../node_modules/@types/jsrender/index.d.ts\" />\r\n\"use strict\";\r\n\r\n// ReSharper disable once InconsistentNaming\r\ndeclare var jsrender: JQueryStatic;\r\n\r\nmodule BuildFeed\r\n{\r\n    let ajax: XMLHttpRequest;\r\n    let timeout: number;\r\n\r\n    export function MobileMenuToggle(this: Element, ev: Event)\r\n    {\r\n        ev.preventDefault();\r\n\r\n        const list = this.nextElementSibling;\r\n        if (list != null)\r\n        {\r\n            list.classList.toggle(\"open\");\r\n        }\r\n    }\r\n\r\n    export function DropdownClick(this: Element, ev: Event)\r\n    {\r\n        ev.preventDefault();\r\n\r\n        const linkParent = this.parentElement;\r\n        if (linkParent == null)\r\n        {\r\n            return;\r\n        }\r\n\r\n        const alreadyOpen = linkParent.classList.contains(\"open\");\r\n\r\n        CloseDropdowns(ev);\r\n\r\n        if (!alreadyOpen)\r\n        {\r\n            linkParent.classList.toggle(\"open\");\r\n\r\n            const menuClickCapture = document.getElementById(\"menu-open-overlay\");\r\n            if (menuClickCapture != null)\r\n            {\r\n                menuClickCapture.classList.add(\"open\");\r\n            }\r\n        }\r\n    }\r\n\r\n    export function CloseDropdowns(ev: Event)\r\n    {\r\n        ev.preventDefault();\r\n\r\n        const ddParents = document.getElementsByClassName(\"dropdown-parent\");\r\n        for (let i = 0; i < ddParents.length; i++)\r\n        {\r\n            ddParents[i].classList.remove(\"open\");\r\n        }\r\n\r\n        const menuClickCapture = document.getElementById(\"menu-open-overlay\");\r\n        if (menuClickCapture != null)\r\n        {\r\n            menuClickCapture.classList.remove(\"open\");\r\n        }\r\n    }\r\n\r\n    export function SwitchTheme(this: HTMLElement, ev: Event)\r\n    {\r\n        ev.preventDefault();\r\n\r\n        document.cookie = `bf_theme=${this.dataset[\"theme\"]}; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/`;\r\n        location.reload(true);\r\n    }\r\n\r\n    export function SwitchLanguage(this: HTMLElement, ev: Event)\r\n    {\r\n        ev.preventDefault();\r\n\r\n        document.cookie = `bf_lang=${this.dataset[\"lang\"]}; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/`;\r\n        location.reload(true);\r\n    }\r\n\r\n    export function OpenSearch(ev: Event)\r\n    {\r\n        ev.preventDefault();\r\n\r\n        const modal = document.getElementById(\"modal-search-overlay\");\r\n        if (modal != null)\r\n        {\r\n            modal.classList.add(\"open\");\r\n        }\r\n    }\r\n\r\n    export function CloseSearch(ev: Event)\r\n    {\r\n        ev.preventDefault();\r\n\r\n        const modal = document.getElementById(\"modal-search-overlay\");\r\n        if (modal != null)\r\n        {\r\n            modal.classList.remove(\"open\");\r\n        }\r\n    }\r\n\r\n    export function StopClick(ev: Event)\r\n    {\r\n        ev.preventDefault();\r\n        ev.stopPropagation();\r\n    }\r\n\r\n    export function InitiateSearch()\r\n    {\r\n        const resultPane = document.getElementById(\"modal-search-result\");\r\n        if (resultPane == null)\r\n        {\r\n            return;\r\n        }\r\n\r\n        resultPane.innerHTML = \"\";\r\n\r\n        if (typeof (timeout) !== \"undefined\")\r\n        {\r\n            clearTimeout(timeout);\r\n        }\r\n\r\n        if (typeof (ajax) !== \"undefined\" && ajax.readyState !== XMLHttpRequest.DONE)\r\n        {\r\n            ajax.abort();\r\n        }\r\n\r\n        timeout = setInterval(SendSearch, 200);\r\n    }\r\n\r\n    export function SendSearch()\r\n    {\r\n        if (typeof (timeout) !== \"undefined\")\r\n        {\r\n            clearTimeout(timeout);\r\n        }\r\n\r\n        const modalInput = document.getElementById(\"modal-search-input\") as HTMLInputElement;\r\n\r\n        ajax = new XMLHttpRequest();\r\n        ajax.onreadystatechange = CompleteSearch;\r\n        ajax.open(\"GET\", `/api/GetSearchResult/${modalInput.value}/`, true);\r\n        ajax.setRequestHeader(\"accept\", \"application/json\");\r\n        ajax.send(null);\r\n    }\r\n\r\n    export function CompleteSearch(this: XMLHttpRequest)\r\n    {\r\n        if (this.readyState !== XMLHttpRequest.DONE || this.status !== 200)\r\n        {\r\n            return;\r\n        }\r\n\r\n        const resultPane = document.getElementById(\"modal-search-result\");\r\n        const templateContent = document.getElementById(\"result-template\");\r\n        if (resultPane == null || templateContent == null)\r\n        {\r\n            return;\r\n        }\r\n\r\n        const template = jsrender.templates(templateContent.innerHTML);\r\n        const content = template.render(JSON.parse(ajax.responseText));\r\n        resultPane.innerHTML = content;\r\n\r\n        const resultLinks = resultPane.getElementsByTagName(\"a\");\r\n        for (let i = 0; i < resultLinks.length; i++)\r\n        {\r\n            resultLinks[i].addEventListener(\"click\",\r\n                (mev: MouseEvent) =>\r\n                {\r\n                    mev.preventDefault();\r\n                    const modalInput = document.getElementById(\"modal-search-input\") as HTMLInputElement;\r\n                    ga(\"send\", \"pageview\", `/api/GetSearchResult/${modalInput.value}/`);\r\n                    location.assign((mev.currentTarget as HTMLAnchorElement).href);\r\n                });\r\n        }\r\n    }\r\n\r\n    export function BuildFeedSetup()\r\n    {\r\n        const ddParents = document.getElementsByClassName(\"dropdown-parent\");\r\n        for (let i = 0; i < ddParents.length; i++)\r\n        {\r\n            for (let j = 0; j < ddParents[i].childNodes.length; j++)\r\n            {\r\n                const el = ddParents[i].childNodes[j];\r\n\r\n                if (el.nodeName === \"A\")\r\n                {\r\n                    el.addEventListener(\"click\", DropdownClick);\r\n                }\r\n            }\r\n        }\r\n\r\n        const menuClickCapture = document.getElementById(\"menu-open-overlay\");\r\n        if (menuClickCapture != null)\r\n        {\r\n            menuClickCapture.addEventListener(\"click\", CloseDropdowns);\r\n        }\r\n\r\n        const menuTheme = document.getElementById(\"settings-theme-menu\");\r\n        if (menuTheme != null)\r\n        {\r\n            const ddThemes = menuTheme.getElementsByTagName(\"a\");\r\n            for (let i = 0; i < ddThemes.length; i++)\r\n            {\r\n                ddThemes[i].addEventListener(\"click\", SwitchTheme);\r\n            }\r\n        }\r\n\r\n        const menuLang = document.getElementById(\"settings-lang-menu\");\r\n        if (menuLang != null)\r\n        {\r\n            const ddLangs = menuLang.getElementsByTagName(\"a\");\r\n            for (let i = 0; i < ddLangs.length; i++)\r\n            {\r\n                ddLangs[i].addEventListener(\"click\", SwitchLanguage);\r\n            }\r\n        }\r\n\r\n        const btnNav = document.getElementById(\"page-navigation-toggle\");\r\n        if (btnNav != null)\r\n        {\r\n            btnNav.addEventListener(\"click\", MobileMenuToggle);\r\n        }\r\n\r\n        const btnSearch = document.getElementById(\"page-navigation-search\");\r\n        if (btnSearch != null)\r\n        {\r\n            btnSearch.addEventListener(\"click\", OpenSearch);\r\n        }\r\n\r\n        const modalOverlay = document.getElementById(\"modal-search-overlay\");\r\n        if (modalOverlay != null)\r\n        {\r\n            modalOverlay.addEventListener(\"click\", CloseSearch);\r\n        }\r\n\r\n        const modalDialog = document.getElementById(\"modal-search\");\r\n        if (modalDialog != null)\r\n        {\r\n            modalDialog.addEventListener(\"click\", StopClick);\r\n        }\r\n\r\n        const modalInput = document.getElementById(\"modal-search-input\");\r\n        if (modalInput != null)\r\n        {\r\n            modalInput.addEventListener(\"keyup\", InitiateSearch);\r\n        }\r\n    }\r\n}\r\n\r\nwindow.addEventListener(\"load\", BuildFeed.BuildFeedSetup);"]}